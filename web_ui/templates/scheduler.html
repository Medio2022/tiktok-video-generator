<!DOCTYPE html>
<html lang="fr" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Planificateur - TikTok Generator</title>

    <link rel="stylesheet" href="/static/css/output.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-900 text-white min-h-screen">
    <div x-data="schedulerApp()" x-init="init()" class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="mb-8">
            <a href="/" class="text-slate-400 hover:text-white transition-colors inline-flex items-center gap-2 mb-4">
                ‚Üê Retour au Dashboard
            </a>
            <h1 class="text-4xl font-bold mb-2">üìÖ Planificateur</h1>
            <p class="text-slate-400">G√©rez vos publications planifi√©es</p>
        </div>

        <!-- Upcoming Schedule -->
        <div class="bg-slate-800 rounded-xl p-8 mb-6">
            <h2 class="text-2xl font-bold mb-6">Prochaines Publications</h2>

            <div x-show="schedules.length === 0" class="text-center text-slate-400 py-8">
                Aucune publication planifi√©e
            </div>

            <div class="space-y-4">
                <template x-for="schedule in schedules" :key="schedule.id">
                    <div class="bg-slate-700 rounded-lg p-6 flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üé¨</span>
                                <div>
                                    <h3 class="font-semibold" x-text="`Vid√©o #${schedule.video_id}`"></h3>
                                    <p class="text-sm text-slate-400" x-text="formatDate(schedule.scheduled_time)"></p>
                                </div>
                            </div>

                            <p class="text-sm text-slate-300 mb-2" x-text="schedule.description"></p>
                            <p class="text-sm text-cyan-400" x-text="schedule.hashtags"></p>

                            <div class="mt-2">
                                <span class="text-xs px-3 py-1 rounded-full"
                                    :class="schedule.status === 'pending' ? 'bg-yellow-600' : schedule.status === 'completed' ? 'bg-green-600' : 'bg-red-600'"
                                    x-text="schedule.status_label"></span>
                            </div>
                        </div>

                        <div class="flex gap-2">
                            <button @click="deleteSchedule(schedule.id)"
                                class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Auto-Publication Config -->
        <div class="bg-slate-800 rounded-xl p-8">
            <h2 class="text-2xl font-bold mb-6">‚öôÔ∏è Publication Automatique</h2>

            <div class="bg-yellow-900/30 border border-yellow-700 rounded-lg p-4 mb-6">
                <p class="text-sm text-yellow-200">
                    ‚ö†Ô∏è La publication automatique n√©cessite que les identifiants TikTok soient configur√©s et que le
                    serveur soit actif en permanence.
                </p>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" x-model="autoConfig.enabled"
                            class="w-5 h-5 rounded bg-slate-600 border-slate-500">
                        <span class="font-semibold">Activer la publication automatique</span>
                    </label>
                </div>

                <div x-show="autoConfig.enabled">
                    <label class="block text-sm font-medium mb-2">Fr√©quence (vid√©os par jour)</label>
                    <select x-model="autoConfig.frequency"
                        class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3">
                        <option value="1">1 vid√©o/jour</option>
                        <option value="2">2 vid√©os/jour</option>
                        <option value="3">3 vid√©os/jour</option>
                    </select>
                </div>

                <div x-show="autoConfig.enabled">
                    <label class="block text-sm font-medium mb-2">Horaires de publication</label>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="time" x-model="autoConfig.time1"
                            class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-3">
                        <input type="time" x-model="autoConfig.time2"
                            class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-3">
                    </div>
                </div>

                <button @click="saveAutoConfig"
                    class="w-full bg-cyan-600 hover:bg-cyan-700 font-bold py-3 px-8 rounded-xl transition-all">
                    üíæ Sauvegarder la configuration
                </button>
            </div>
        </div>
    </div>

    <script>
        function schedulerApp() {
            return {
                schedules: [],
                autoConfig: {
                    enabled: false,
                    frequency: '1',
                    time1: '10:00',
                    time2: '18:00'
                },

                async init() {
                    await this.loadSchedules();
                },

                async loadSchedules() {
                    try {
                        const response = await fetch('/api/schedule');
                        const data = await response.json();

                        if (data.success) {
                            this.schedules = data.schedules.map(s => ({
                                ...s,
                                status_label: s.status === 'pending' ? '‚è≥ En attente' :
                                    s.status === 'completed' ? '‚úÖ Publi√©' : '‚ùå √âchou√©'
                            }));
                        }
                    } catch (error) {
                        console.error('Error loading schedules:', error);
                    }
                },

                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                async deleteSchedule(id) {
                    if (!confirm('Supprimer cette publication planifi√©e ?')) return;

                    try {
                        const response = await fetch(`/api/schedule/${id}`, {
                            method: 'DELETE'
                        });

                        if (response.ok) {
                            await this.loadSchedules();
                        }
                    } catch (error) {
                        console.error('Error deleting schedule:', error);
                        alert('Erreur lors de la suppression');
                    }
                },

                async saveAutoConfig() {
                    alert('Configuration sauvegard√©e ! (Fonctionnalit√© compl√®te √† impl√©menter)');
                }
            }
        }
    </script>
</body>

</html>